<%= form_with(model: @post, url: choose_new_or_edit, local: true, multipart: true) do |form| %>
  <% if @post.errors.any? %>
    <div id="error_explanation">
      <h2 class="alert alert-success" role="alert"><%= @post.errors.count %>件のエラーがあります。</h2>
      <ul class="alert alert-danger" role="alert">
      <% @post.errors.full_messages.each do |msg| %>
        <li ><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
<section class="fdb-block fp-active" style="background-image: url(../gahag-0094418071-1.jpg)" data-block-type="forms" data-id="3" draggable="true">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-7 col-xl-5 text-center">
        <div class="fdb-box fdb-touch">
          <div class="row">
            <div class="col">
              <h1>投稿画面</h1>
              <p class="text-h3">写真を選択するボタンから画像を選択したらメッセージを添えて投稿してみてください！</p>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col">
              <div class="row mt-4">
                <div class="col">
                  <div class="field">
                    <%= image_tag(@post.image_url, :class => "uploadFile", :style => " width: 100%; object-fit: cover;  border:solid 1px #ccc;padding:4px;") if @post.image.url %>
                  </div>
                </div>
              </div>
              <div class="field">
                <label class="btn btn-primary">
                	<strong>＋写真を選択する</strong>
                <%= form.file_field :image, id: :feed_image, :style=>"display:none;", :type=>"file"%>
              </label>
              </div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col">
              <%= form.text_field :comment ,:class=>"form-control", :placeholder=>"メッセージを入力"%>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col">
              <%= form.submit "投稿する", :class=>"btn" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<% end %>
<!--
<form action="" method="post" enctype="multipart/form-data">
    <div class="imagePreview"></div>
    <div class="input-group">
        <label class="input-group-btn">
            <span class="btn btn-primary">
                Choose File<input type="file" style="display:none" class="uploadFile">
            </span>
        </label>
        <input type="text" class="form-control" readonly="">
    </div>
</form>
-->
<script>
$(document).on('change', ':file', function() {
    var input = $(this),
    numFiles = input.get(0).files ? input.get(0).files.length : 1,
    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
    input.parent().parent().next(':text').val(label);

    var files = !!this.files ? this.files : [];
    if (!files.length || !window.FileReader) return; // no file selected, or no FileReader support
    if (/^image/.test( files[0].type)){ // only image file
        var reader = new FileReader(); // instance of the FileReader
        reader.readAsDataURL(files[0]); // read the local file
        reader.onloadend = function(){ // set image data as background of div
            input.parent().parent().parent().prev('.imagePreview').css("background-image", "url("+this.result+")");
        }
    }
});
</script>
